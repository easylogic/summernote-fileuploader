!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t():"function"==typeof define&&define.amd?define(t):t()}(0,function(){"use strict";var e=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},t=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),i=function e(t,i,n){null===t&&(t=Function.prototype);var l=Object.getOwnPropertyDescriptor(t,i);if(void 0===l){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,n)}if("value"in l)return l.value;var r=l.get;if(void 0!==r)return r.call(n)},n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},l=function(){function i(t){e(this,i),this.context=t,this.events={},this.initializeSummernoteResources()}return t(i,[{key:"filterProps",value:function(e){return Object.getOwnPropertyNames(this.__proto__).filter(function(t){return t.includes(e)})}},{key:"initializeSummernoteResources",value:function(){var e=this;this.filterProps("button.").forEach(function(t){e.context.memo(t,e[t].bind(e))}),this.filterProps("summernote.").forEach(function(t){e.events[t]=e[t].bind(e)})}},{key:"invoke",value:function(){this.context.invoke.apply(this.context,[].concat(Array.prototype.slice.call(arguments)))}},{key:"initialize",value:function(){}},{key:"destroy",value:function(){}}]),i}(),o=0,r=function(){function i(t,n,l){e(this,i),this.tag=t,this.className=n,this.attr=l,this.initialize()}return t(i,[{key:"initialize",value:function(){if("string"!=typeof this.tag)this.el=this.tag;else{var e=document.createElement(this.tag);this.uniqId=o++,e.className=this.className;var t=this.attr||{};for(var i in t)e.setAttribute(i,t[i]);this.el=e}}},{key:"closest",value:function(e){for(var t=this,n=!1;!(n=t.hasClass(e));){if(!t.el.parentNode)return null;t=new i(t.el.parentNode)}return n?t:null}},{key:"removeClass",value:function(e){this.el.className=i.trim((" "+this.el.className+" ").replace(" "+e+" "," "))}},{key:"hasClass",value:function(e){if(!this.el.className)return!1;return(" "+this.el.className+" ").indexOf(" "+e+" ")>-1}},{key:"addClass",value:function(e){return this.hasClass(e)||(this.el.className=this.el.className+" "+e),this}},{key:"html",value:function(e){if(0==arguments.length)return this.el.innerHTML;if(Array.isArray(e)){var t=e.map(function(e){return e.el?e.el:e}),i=document.createDocumentFragment();t.forEach(function(e){i.appendChild(e)}),this.el.innerHTML="",this.el.append(i)}else this.el.innerHTML=e;return this}},{key:"empty",value:function(){return this.html("")}},{key:"append",value:function(e){return"string"==typeof e?this.el.appendChild(document.createTextNode(e)):this.el.appendChild(e.el||e),this}},{key:"appendTo",value:function(e){if("string"==typeof e&&(e=document.querySelector(e)),e){(e.el?e.el:e).appendChild(this.el)}return this}},{key:"remove",value:function(){return this.el.parentNode&&this.el.parentNode.removeChild(this.el),this}},{key:"text",value:function(){return this.el.textContent}},{key:"css",value:function(e,t){if(2==arguments.length)this.el.style[e]=t;else if(1==arguments.length){if("string"==typeof e)return getComputedStyle(this.el)[e];var i=e||{};for(var n in i)this.el.style[n]=i[n]}return this}},{key:"offset",value:function(){var e=this.el.getBoundingClientRect();return{top:e.top+document.body.scrollTop,left:e.left+document.body.scrollLeft}}},{key:"position",value:function(){return{top:parseFloat(this.el.style.top),left:parseFloat(this.el.style.left)}}},{key:"width",value:function(){return this.el.offsetWidth}},{key:"height",value:function(){return this.el.offsetHeight}},{key:"dataKey",value:function(e){return this.uniqId+"."+(e||"")}},{key:"val",value:function(e){return 0==arguments.length?this.el.value:(1==arguments.length&&(this.el.value=e),this)}},{key:"int",value:function(e){return 0==arguments.length?parseInt(this.val(),10):(this.val(parseInt(e,10)),this)}},{key:"float",value:function(e){return 0==arguments.length?parseFloat(this.val()):(this.val(parseFloat(e)),this)}},{key:"show",value:function(){return this.css("display","block")}},{key:"hide",value:function(){return this.css("display","none")}},{key:"addEventListener",value:function(e,t,i){this.el.addEventListener(e,t,i||!1)}},{key:"removeEventListener",value:function(e,t,i){this.el.removeEventListener(e,t)}}],[{key:"trim",value:function(e){return e.replace(/^\s+|\s+$/g,"")}}]),i}(),s=function(){function i(t,n){e(this,i),this.uploader=t,this.context=n,this.options=this.context.options.fileuploader||{},this.server=this.options.server||{},this.files=[]}return t(i,[{key:"uploadToServer",value:function(e,t){var i=this,n=new FormData;n.append("summernote-file-index",t),n.append("summernote-file",e),new Request({url:"",params:"",formData:n,success:function(n){i.uploader.success(e,t)},updateProgress:function(n){i.uploader.updateProgress(e,t,n.loaded,n.total)},fail:function(n){i.uploader.fail(e,t)}}).send()}},{key:"removeFile",value:function(e){this.files.splice(e,1)}},{key:"getFiles",value:function(){return this.files}},{key:"addFile",value:function(e){this.files.push(e)}},{key:"addFiles",value:function(e){var t=this;Array.isArray(e)||(e=[e]),e.forEach(function(e){t.addFile(e)})}},{key:"uploadFile",value:function(e,t){var i=e;this.files[e]&&(i=this.files[e]),this.uploadToServer(i,t)}},{key:"uploadAllFiles",value:function(e){var t=this;(e||this.files||[]).forEach(function(e,i){t.uploadFile(e,i)})}}]),i}(),a=function(){function i(t,n){e(this,i),this.uploader=t,this.context=n,this.options=n.options.fileuploader||{},this.initialize()}return t(i,[{key:"initialize",value:function(){this.$el=new r("div","summernote-fileuploader-upload-panel"),this.$fileInput=new r("input","",{type:"file",multiple:!0,accept:this.options.accept||"*/*"}),this.$el.append(this.$fileInput),this.initializeEvent()}},{key:"openFileDialog",value:function(){this.$fileInput.el.click()}},{key:"changeFileInput",value:function(e){this.uploader.addFile([].concat(function(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}(e.target.files)))}},{key:"initializeEvent",value:function(){this.$$changeFileInput=this.changeFileInput.bind(this),this.$fileInput.addEventListener("change",this.$$changeFileInput)}},{key:"appendTo",value:function(e){var t=document.querySelector(e);t&&this.$el.appendTo(t)}},{key:"destroy",value:function(){this.$fileInput.removeEventListener("change",this.$$changeFileInput),this.$el.remove(),this.$fileInput=null,this.$el=null}}]),i}(),u=function(){function i(t,n){e(this,i),this.uploader=t,this.context=n,this.initialize()}return t(i,[{key:"initialize",value:function(){this.$el=new r("div","summernote-fileuploader-preview-panel"),this.initializeEvent()}},{key:"refresh",value:function(){this.render()}},{key:"renderViewItem",value:function(e,t){return new r("div","view-item",{"data-index":t,"data-name":e.name,"data-type":e.type,"data-file":e}).html("item")}},{key:"render",value:function(){var e=this,t=this.uploader.getFiles().map(function(t,i){return e.renderViewItem(t,i)});this.$el.html(t)}},{key:"initializeEvent",value:function(){}},{key:"destroy",value:function(){this.$el.remove(),this.$el=null}}]),i}(),h=function(o){function h(t){return e(this,h),n(this,(h.__proto__||Object.getPrototypeOf(h)).call(this,t))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(h,l),t(h,[{key:"button.fileuploader",value:function(){var e=this;return $.summernote.ui.button({contents:"Uploader",tooltip:"File Uploader",click:function(){e.$panel.show(),e.invoke("editor.insertText","hello")}}).render()}},{key:"button.simple-fileuploader",value:function(){var e=this;return $.summernote.ui.button({contents:"Simple Uploader",tooltip:"File Uploader",click:function(){e.openFileDialog()}}).render()}},{key:"openFileDialog",value:function(){this.uploadPanel.openFileDialog()}},{key:"summernote.init",value:function(e,t){console.log("summernote initalized")}},{key:"summernote.keyup",value:function(e,t){console.log("summernote keyup",t)}},{key:"initialize",value:function(){i(h.prototype.__proto__||Object.getPrototypeOf(h.prototype),"initialize",this).call(this),this.previewPanel=new u(this,this.context),this.uploadPanel=new a(this,this.context),this.fileManager=new s(this,this.context),this.$panel=new r("div","summernote-fileuploader",{droppable:!0}),this.$panel.append(this.uploadPanel.$el),this.$panel.append(this.previewPanel.$el),this.$panel.appendTo("body"),this.initializeEvent()}},{key:"drop",value:function(e){console.log("drop",e)}},{key:"dragover",value:function(e){console.log("dragover",e)}},{key:"initializeEvent",value:function(){this.$$drop=this.drop.bind(this),this.$$dragover=this.dragover.bind(this),this.$panel.addEventListener("drop",this.$$drop),this.$panel.addEventListener("dragover",this.$$dragover)}},{key:"destroy",value:function(){i(h.prototype.__proto__||Object.getPrototypeOf(h.prototype),"destroy",this).call(this),this.$panel.removeEventListener("drop",this.$$drop),this.$panel.removeEventListener("dragover",this.$$dragover),this.uploadPanel.destroy(),this.previewPanel.destroy(),this.uploadPanel=null,this.previewPanel=null,this.$panel.remove(),this.$panel=null}},{key:"addFile",value:function(e){Array.isArray(e)||(e=[e]),this.fileManager.addFiles(e),this.previewPanel.refresh()}},{key:"getFiles",value:function(){return this.fileManager.getFiles()}},{key:"upload",value:function(e,t){}}]),h}();$.extend($.summernote.plugins,{uploader:h})});
